server {
    include                         /etc/Lemp/7.0/nginx/add-fastcgi.conf;

    listen                          8080;
    server_name                     ezp_17x.qa-002.dev;

    root                            /var/www/ezp_17x/web;

    ## Don't forget to run php app/console assetic:dump --env=prod
    include                         /var/www/ezp_17x/doc/nginx/ez_params.d/ez_prod_rewrite_params;

    # ez rewrite rules
    include                         /var/www/ezp_17x/doc/nginx/ez_params.d/ez_rewrite_params;

    # Custom logs
    access_log                      /var/www/ezp_17x/app/logs/ezp_17x.access.log devaneando;
    error_log                       /var/www/ezp_17x/app/logs/ezp_17x.error.log notice;

    include                         /var/www/ezp_17x/doc/nginx/ez_params.d/ez_server_params;

    location / {
        location ~ ^/app\.php(/|$) {
            include                 /var/www/ezp_17x/doc/nginx/ez_params.d/ez_fastcgi_params;

            # FPM socket
            # Possible values : unix:/var/run/php5-fpm.sock or 127.0.0.1:9000
            fastcgi_pass            unix:/run/php/devaneando.sock;

            # Possible values: "prod" and "dev" out-of-the-box, other values possible with proper configuration
            fastcgi_param           SYMFONY_ENV prod;

            # Possible values: 0 or 1
            fastcgi_param           SYMFONY_DEBUG "0";

            # Optional: Whether to use Symfony's builtin HTTP Caching Proxy.
            # Disable it if you are using an external reverse proxy (e.g. Varnish)
            # Possible values: 0 or 1
            fastcgi_param           SYMFONY_HTTP_CACHE "0";

            # Optional: Defines the proxies to trust
            # Needed when using Varnish as proxy, if so disable SYMFONY_HTTP_CACHE.
            fastcgi_param           SYMFONY_TRUSTED_PROXIES "127.0.0.1,";
        }
    }

}

server {
    listen                          80;
    server_name                     ezp_17x.qa-002.dev;

    location / {
        proxy_pass http://ezp_17x.qa-002.dev:6081;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}


server {

    # https://www.digitalocean.com/community/tutorials/how-to-configure-nginx-with-ssl-as-a-reverse-proxy-for-jenkins

    include                         /etc/Lemp/7.0/nginx/add-ssl.conf;
    server_name                     ezp_17x.qa-002.dev;

    # Custom logs
    access_log                      /var/www/ezp_17x/app/logs/ezp_17x.access.log devaneando;
    error_log                       /var/www/ezp_17x/app/logs/ezp_17x.error.log notice;

    location / {

      proxy_set_header              Host $host;
      proxy_set_header              X-Real-IP $remote_addr;
      proxy_set_header              X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header              X-Forwarded-Proto $scheme;

      # Fix the â€œIt appears that your reverse proxy set up is broken" error.
      proxy_pass                    http://ezp_17x.qa-002.dev:6081;
      proxy_read_timeout            90;

    }

}

