server {
    listen                          80;
    server_name                     ezp_16x.qa-002.dev;
    return                          301 https://$server_name$request_uri;
}

server {
    listen                          443 ssl;
    server_name                     ezp_16x.qa-002.dev;

    root                            /var/www/ezp_16x/web;

    ## Don't forget to run php app/console assetic:dump --env=prod
    include                         ez_params.16x.d/ez_prod_rewrite_params;

    # ez rewrite rules
    include                         ez_params.16x.d/ez_rewrite_params;

    # add Strict-Transport-Security to prevent man in the middle attacks
    add_header                      Strict-Transport-Security "max-age=31536000";

    ssl_certificate                 /etc/nginx/Cert/qa-002.dev.crt;
    ssl_certificate_key             /etc/nginx/Cert/qa-002.dev.key;

    # Cluster/streamed files rewrite rules. Enable on cluster with DFS as a binary data handler
    rewrite                         "^/var/([^/]+/)?storage/images(-versioned)?/(.*)" "/app.php" break;

    # upload max size
    client_max_body_size            20m;

    # FPM fastcgi_read_timeout
    fastcgi_read_timeout            300s;

    location / {
        location ~ ^/app\.php(/|$) {
            include                 ez_params.16x.d/ez_fastcgi_params;

            # FPM socket
            # Possible values : unix:/var/run/php5-fpm.sock or 127.0.0.1:9000
            fastcgi_pass            unix:/run/php/devaneando.sock;

            # Possible values: "prod" and "dev" out-of-the-box, other values possible with proper configuration
            fastcgi_param           SYMFONY_ENV prod;

            # Possible values: 0 or 1
            fastcgi_param           SYMFONY_DEBUG "0";

            # Optional: Whether to use Symfony's builtin HTTP Caching Proxy.
            # Disable it if you are using an external reverse proxy (e.g. Varnish)
            # Possible values: 0 or 1
            fastcgi_param           SYMFONY_HTTP_CACHE "1";

            # Optional: Defines the proxies to trust
            # Needed when using Varnish as proxy, if so disable SYMFONY_HTTP_CACHE.
            fastcgi_param           SYMFONY_TRUSTED_PROXIES "127.0.0.1,";
        }
    }

    # Custom logs
    access_log                      /var/www/ezp_16x/app/logs/ezp_16x.access.log devaneando;
    error_log                       /var/www/ezp_16x/app/logs/ezp_16x.error.log notice;

    include                         ez_params.16x.d/ez_server_params;
}
